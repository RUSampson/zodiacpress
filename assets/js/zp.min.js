!function(e){e("#place").autocomplete({source:function(t,n){zpRemoveError(),e.ajax({url:"https://secure.geonames.org/searchJSON",dataType:"json",type:"GET",data:{featureClass:"P",style:"full",maxRows:20,username:zp_ajax_object.geonames_user,name_startsWith:t.term,lang:zp_ajax_object.lang},success:function(t){if(void 0!==t.status){var r=e("<span />");r.attr("class","ui-state-error"),r.text("ERROR "+t.status.value+" - "+t.status.message),e("#zp-ajax-birth-data").append(r)}n(e.map(t.geonames,function(e){return{value:e.name+(e.adminName1?", "+e.adminName1:"")+", "+e.countryName,label:e.name+(e.adminName1?", "+e.adminName1:"")+", "+e.countryName,lngdeci:e.lng,latdeci:e.lat,timezoneid:e.timezone.timeZoneId}}))}})},minLength:2,select:function(e,t){var n={geo_timezone_id:t.item.timezoneid,zp_lat_decimal:t.item.latdeci,zp_long_decimal:t.item.lngdeci};for(var r in n){var a=document.getElementById(r);null!==a&&a.remove(),elInput=document.createElement("input"),elInput.type="hidden",elInput.id=r,elInput.name=r,elInput.value=n[r],document.getElementById("zp-timezone-id").appendChild(elInput)}zpGetOffset()}})}(jQuery);var zpSubmit=document.getElementById("zp-fetch-birthreport");function zpGetOffset(){const e=jQuery("#zp-ajax-birth-data :input").serialize()+"&action=zp_tz_offset",t=new XMLHttpRequest;t.open("POST",zp_ajax_object.ajaxurl),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.responseType="json",t.onload=function(){if(200===t.status&&t.response)if(t.response.error){zpRemoveError();var e=document.createElement("span");e.setAttribute("class","ui-state-error"),e.textContent=t.response.error,document.getElementById("zp-ajax-birth-data").appendChild(e)}else null!==t.response.offset_geo&&""!==t.response.offset_geo&&"false"!=t.response.offset_geo&&(zpRemoveError(),document.getElementById("zp-offset-wrap").style.display="block",document.getElementById("zp-offset-label").textContent=zp_ajax_object.utc+" ",document.getElementById("zp_offset_geo").value=t.response.offset_geo,document.getElementById("zp-form-tip").style.display="block",zpSubmit.removeAttribute("disabled"))},t.send(e)}function zpFieldsFilled(){for(var e of["geo_timezone_id","zp_long_decimal","zp_lat_decimal","place","minute","hour","year","day","month"]){var t=document.getElementById(e);if(null===t)return!1;if(0===t.value.length||!t.value.trim()){if(("minute"===e||"hour"===e)&&document.getElementById("unknown_time").checked)continue;return!1}}return!0}function zpRemoveError(){var e=document.querySelector(".ui-state-error");null!==e&&e.parentNode.removeChild(e)}zpSubmit.setAttribute("disabled",!0),function(e){e("#zp-fetch-birthreport").click(function(){return e.ajax({url:zp_ajax_object.ajaxurl,type:"POST",data:e("#zp-birthreport-form").serialize(),dataType:"json",success:function(t){if(t.error){zpRemoveError();var n=e("<span />");n.attr("class","ui-state-error"),n.text(t.error),e("#zp-offset-wrap").after(n)}else{var r=t.report.trim();if(r&&"false"!=r){switch(zpRemoveError(),e("#zp-report-wrap").show(),e("#zp-report-content").append(t.report),e("#zp-form-wrap").hide(),zp_ajax_object.draw){case"top":e(".zp-report-header").length?e(".zp-report-header").after(t.image):e("#zp-report-content").prepend(t.image);break;case"bottom":e("#zp-report-content").append(t.image)}var a=e("#zp-report-wrap").offset().top-70;e("html,body").animate({scrollTop:a},"slow")}}}}),!1}),e("#month, #day, #year, #hour, #minute").on("change",function(){!this.options[this.selectedIndex].defaultSelected&&zpFieldsFilled()&&zpGetOffset()}),e("#unknown_time").on("change",function(){e(this).is(":checked")&&zpFieldsFilled()&&zpGetOffset()})}(jQuery);
